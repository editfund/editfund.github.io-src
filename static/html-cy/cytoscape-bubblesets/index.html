<!DOCTYPE html>
<html>
  <head>
    <title>ä»“åº“æ˜Ÿç©ºå›¾</title>
    <style>
      #app {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        right: 0;
        background-color: gray;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
  </body>
  <script src="https://cdn-cytoscape.deno.dev/cytoscape@3.28.0/dist/cytoscape.min.js"></script>
  <script src=" https://npm-cdn.deno.dev/cytoscape-layers@2.4.3/build/index.umd.min.js"></script>
  <script src=" https://npm-cdn.deno.dev/cytoscape-bubblesets@3.2.0/build/index.umd.min.js"></script>

  <script src=" https://npm-cdn.deno.dev/layout-base@2.0.1/layout-base.js"></script>
  <script src=" https://npm-cdn.deno.dev/avsdf-base@1.0.0/avsdf-base.js"></script>
  <script src=" https://npm-cdn.deno.dev/cytoscape-avsdf@1.0.0/cytoscape-avsdf.js"></script>
  <script>
    const cy = cytoscape({
      container: document.getElementById("app"), // container to render in

      layout: {
        name: "avsdf",
        nodeSeparation: 120,
      },

      style: [
        {
          selector: "node",
          style: {
            label: "data(label)",
            'border-width': 1,
            "text-valign": "bottom",
            color: "#000000",
            //"background-color": "#3a7ecf",
            //background-image-opacity
            //background-image-smoothing
            //background-image-containment ðŸ“ŒDetermines whether background image is within (inside, default) or over top of the node(over).
            //background-fit ðŸ“ŒHow the background image is fit to the node; may be none for original size, contain to fit inside node, or cover to cover the node.
            //"background-image": "img/F26.webp",
            "background-fit": "contain"
          },
        },

        {
          selector: "#v3",
          style: {
            label: "data(label)",
            'border-width': 1,
            "text-valign": "bottom",
            color: "#000000",
            //"background-color": "#3a7ecf",
            //background-image-opacity
            //background-image-smoothing
            //background-image-containment ðŸ“ŒDetermines whether background image is within (inside, default) or over top of the node(over).
            //background-fit ðŸ“ŒHow the background image is fit to the node; may be none for original size, contain to fit inside node, or cover to cover the node.
            "background-image": "img/F.png",
            "background-fit": "contain"
          },
        },

        {
          selector: "#v5",
          style: {
            label: "data(label)",
            'border-width': 1,
            "text-valign": "bottom",
            color: "#000000",
            //"background-color": "#3a7ecf",
            //background-image-opacity
            //background-image-smoothing
            //background-image-containment ðŸ“ŒDetermines whether background image is within (inside, default) or over top of the node(over).
            //background-fit ðŸ“ŒHow the background image is fit to the node; may be none for original size, contain to fit inside node, or cover to cover the node.
            "background-image": "img/gitea.svg",
            "background-fit": "contain"
          },
        },

        {
          selector: "#v6",
          style: {
            label: "data(label)",
            'border-width': 1,
            "text-valign": "bottom",
            color: "#000000",
            //"background-color": "#3a7ecf",
            //background-image-opacity
            //background-image-smoothing
            //background-image-containment ðŸ“ŒDetermines whether background image is within (inside, default) or over top of the node(over).
            //background-fit ðŸ“ŒHow the background image is fit to the node; may be none for original size, contain to fit inside node, or cover to cover the node.
            "background-image": "img/gopher-golfer.svg",
            "background-fit": "contain",
          },
        },

        {
          selector: "#v7",
          style: {
            label: "data(label)",
            'border-width': 1,
            "text-valign": "bottom",
            color: "#000000",
            //"background-color": "#3a7ecf",
            //background-image-opacity
            //background-image-smoothing
            //background-image-containment ðŸ“ŒDetermines whether background image is within (inside, default) or over top of the node(over).
            //background-fit ðŸ“ŒHow the background image is fit to the node; may be none for original size, contain to fit inside node, or cover to cover the node.
            "background-image": "img/go-git.png",
            "background-fit": "contain",
          },
        },

        {
          selector: "edge",
          style: {
            width: 2,
            "line-color": "#3a7ecf",
            opacity: 0.5,
          },
        },
      ],

      elements: {
        nodes: [
          {
            data: {
              id: "v1",
              label: "act_runner",
              issues: "1",
              weight: 1,
              href: "https://gitea.com/gitea/act_runner/releases",
            },
          },
          {
            data: {
              id: "v2",
              label: "go-sdk",
              issues: "2",
              weight: 2,
              href: "https://gitea.com/gitea/go-sdk",
            },
          },
          {
            data: {
              id: "v3",
              label: "Fomantic-UI",
              issues: "3",
              weight: 3,
              href: "https://github.com/fomantic/Fomantic-UI",
            },
          },
          {
            data: {
              id: "v4",
              label: "tea",
              issues: "4",
              weight: 4,
              href: "https://gitea.com/gitea/tea",
            },
          },
          {
            data: {
              id: "v5",
              label: "gitea",
              issues: "5",
              weight: 5,
              href: "https://github.com/go-gitea/gitea",
            },
          },
          {
            data: {
              id: "v6",
              label: "Go",
              issues: "6",
              weight: 6,
              href: "https://github.com/golang/go",
            },
          },
          {
            data: {
              id: "v7",
              label: "go-git",
              issues: "7",
              weight: 7,
              href: "https://github.com/go-git",
            },
          },
        ],
        edges: [
          { data: { source: "v1", target: "v2", directed: "false" } },
          { data: { source: "v1", target: "v4", directed: "false" } },
          { data: { source: "v1", target: "v5", directed: "false" } },
          { data: { source: "v2", target: "v4", directed: "false" } },
          { data: { source: "v2", target: "v6", directed: "false" } },
          { data: { source: "v3", target: "v4", directed: "false" } },
          { data: { source: "v4", target: "v5", directed: "false" } },
          { data: { source: "v4", target: "v7", directed: "false" } },
          { data: { source: "v5", target: "v6", directed: "false" } },
          { data: { source: "v6", target: "v3", directed: "false" } },
        ],
      },
    });
    cy.ready(() => {
      const bb = cy.bubbleSets();
      const edges = cy.edges().slice(0, 4);
      console.log(cy.edges());
      const nodes = edges.connectedNodes();
      bb.addPath(nodes, edges, cy.nodes().diff(nodes).left, {
        drawPotentialArea: true,
        style: {
          fill: "rgba(255, 0, 0, 0.2)",
          stroke: "red",
        },
      });

      const bb2 = cy.bubbleSets();
      const edges2 = cy.$("node#v7").connectedEdges();
      console.log(cy.edges());
      const nodes2 = edges2.connectedNodes();
      bb.addPath(nodes2, edges2, cy.nodes().diff(nodes).left, {
        drawPotentialArea: true,
        style: {
          fill: "rgba(255, 255, 0, 0.2)",
          stroke: "red",
        },
      });
    });
    cy.on("tap", "node", async function (evt) {
      var node = evt.target;
      console.log("tapped " + node.id());
      console.log("tapped " + node.data("issues"));
      
      try {
        // your browser may block popups
        window.open(this.data("href"));
        //window.open(this.data("href") + node.data("issues"));
      } catch (e) {
        // fall back on url change
        window.location.href = this.data("href");
      }
    });
  </script>
</html>
